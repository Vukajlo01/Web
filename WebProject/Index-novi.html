<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="./indexstyle.css" />

    <script src="Scripts/jquery-3.4.1.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            loadProducts();

            function loadProducts() {
                $.get("api/products", function (data, status) {                   
                    for (element in data) {
                        let newProduct = '<div class="item-container">';
                        newProduct += '<img class="image-class" src="./noImage.jpg" />';
                        newProduct += '<p class="product-text">' + data[element].Name + '</p>';
                        newProduct += '<p class="product-text">City</p>';
                        newProduct += '<p class="product-text">' + data[element].Amount + '</p>';
                        newProduct += '<p #id="price-id" class="product-text">' + data[element].Price + '</p>';
                        newProduct += '<button class="button last">Buy</button>';
                        newProduct += '</div>';
                        $(".content-container").append(newProduct);
                    }
                });
            }

            /*
            <div class="item-container">
               <img class="image-class" src="./noImage.jpg" />
               <p class="product-text"> data[element].Name </p>
               <p class="product-text"> City </p>
               <p class="product-text"> data[element].Amount </p>
               <p class="product-text"> data[element].Price </p>
               <button class="button last">Buy</button>
            </div>
            */

            function sort(selector, criteria, direction) {
                $(selector).children().sort(function(a, b) {

                    var A, B;

                    switch (criteria) {
                        case "name":
                            A = $(a).children()[1].innerHTML.toLowerCase();
                            B = $(b).children()[1].innerHTML.toLowerCase();
                            break;
                        case "price":
                            A = $(a).children()[4].innerHTML;
                            B = $(b).children()[4].innerHTML;
                            break;
                        case "city":
                            A = $(a).children()[2].innerHTML.toLowerCase();
                            B = $(b).children()[2].innerHTML.toLowerCase();
                            break;
                        default:
                            alert("Error");
                    }

                    var res = (A < B) ? -1 : (A > B) ? 1 : 0;

                    if(direction == "asc"){
                        return res;
                    }
                    else {
                        return res * (-1);
                    }

                }).appendTo(selector);
            }

            $('select').change(function(e){
                var valueSelected = this.value;                
                var arr = valueSelected.split(",");
                var criteria = arr[0];
                var direction = arr[1];
                console.log(direction);

                sort(".content-container", criteria, direction);
            }); 

            $('#filter-form').submit(function(e) {
                e.preventDefault();               
                
                var nameVal = $('#name').val().trim();
                var minPriceVal = $('#min-price').val().trim();
                var maxPriceVal = $('#max-price').val().trim();
                var cityVal = $('#city').val().trim();

                $(".item-container").each(function(){
                    $(this).show();
                });

                $(".item-container").each(function(){
                    var name = $(this).children()[1].innerHTML.toLowerCase();
                    var price = $(this).children()[4].innerHTML;
                    var city = $(this).children()[2].innerHTML.toLowerCase();

                    if(nameVal){
                        if(name.indexOf(nameVal.toLowerCase()) == -1){
                            $(this).hide();
                        }
                    }
                    if(minPriceVal){
                        if(price < minPriceVal){
                            $(this).hide();
                        }
                    }
                    if(maxPriceVal){
                        if(price > maxPriceVal){
                            $(this).hide();
                        }
                    }
                    if(cityVal){
                        if(city.indexOf(cityVal.toLowerCase()) == -1){
                            $(this).hide();
                        }
                    }

                });
            });


        });
    </script>

</head>

<body>
    <div class="menu-container">
        <div></div>
        <p class="title menu-item">Title</p>  
        <button class="items-btn menu-item">â˜° Items</button>
        <button class="profile-btn menu-item">/ðŸ‘¤ Profile/</button>      
        <!--<button class="cart-btn menu-item">ðŸ›’ Shopping cart</button>-->
        <button class="login-btn menu-item">ðŸ‘¤ Login/out</button>
    </div>
    <div class="grid-container">
        <div class="search-container">
            <form id="filter-form">
                <p>Search by name:</p>
                <input type="text" id="name" /></td>

                <p>Search by price:</p>
                <input id="min-price" class="min-price-input" type="text" />
                <label> - </label>
                <input id="max-price" class="max-price-input" type="text" />

                <p>Search by city:</p>
                <input id="city" type="text" />

                <input type="submit" value="Search" />
            </form>            
        </div>
        <div class="sort-container">
            <label class="sort-label">Sort by:</label>
            <select class="sort-select">
                <option value="name,asc">Name asc</option>
                <option value="name,desc">Name desc</option>
                <option value="price,asc">Price asc</option>
                <option value="price,desc">Price desc</option>
                <option value="city,asc">City asc</option>
                <option value="city,desc">City desc</option>
            </select>
        </div>
        
        <div class="content-container"></div>

    </div>
</body>
    
</html>